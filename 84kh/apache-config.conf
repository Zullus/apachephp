<VirtualHost *:80>
    ServerAdmin admin@localhost
    DocumentRoot /var/www/html
    ServerName localhost

    # Configurações de log
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # Habilitações de reescrita
    <Directory /var/www/html>
        Options -MultiViews +FollowSymLinks
        AllowOverride All
        Require all granted

        # Rewrite rules
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule ^ index.php [L]
        </IfModule>
    </Directory>

    # Configurações de compressão
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
        AddOutputFilter DEFLATE js css xml
    </IfModule>

    # Headers de segurança
    <IfModule mod_headers.c>
        Header set X-Frame-Options "SAMEORIGIN"
        Header set X-Content-Type-Options "nosniff"
        Header set X-XSS-Protection "1; mode=block"
        Header set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>

    # Cache de arquivos estáticos
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType image/jpg "access plus 1 year"
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType text/css "access plus 1 year"
        ExpiresByType application/javascript "access plus 1 year"
        ExpiresByType text/javascript "access plus 1 year"
        ExpiresDefault "access plus 2 days"
    </IfModule>

    # Proteção de arquivos sensíveis
    <FilesMatch "\.(ini|php3|php4|php5|php6|php7|php8|phtml|phar|phps|pht|phpt|pgif|shtml|htaccess|passwd|shadow)$">
        Deny from all
    </FilesMatch>

    # Desabilitar listagem de diretórios
    <Directory /var/www/html>
        Options -Indexes
    </Directory>

</VirtualHost>

# Configuração HTTPS (opcional, descomentar se usar SSL)
# <VirtualHost *:443>
#     ServerAdmin admin@localhost
#     DocumentRoot /var/www/html
#     ServerName localhost
#
#     SSLEngine on
#     SSLCertificateFile /etc/apache2/ssl/cert.pem
#     SSLCertificateKeyFile /etc/apache2/ssl/key.pem
#
#     ErrorLog ${APACHE_LOG_DIR}/error.log
#     CustomLog ${APACHE_LOG_DIR}/access.log combined
#
#     <Directory /var/www/html>
#         Options -MultiViews +FollowSymLinks
#         AllowOverride All
#         Require all granted
#
#         <IfModule mod_rewrite.c>
#             RewriteEngine On
#             RewriteBase /
#             RewriteCond %{REQUEST_FILENAME} !-f
#             RewriteCond %{REQUEST_FILENAME} !-d
#             RewriteRule ^ index.php [L]
#         </IfModule>
#     </Directory>
# </VirtualHost>